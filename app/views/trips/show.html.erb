
<div class="container-showtrip">
  <div class="card-showtrip">
    <% if @trip.photo.attached? %>
      <%= cl_image_tag @trip.photo.key%>
    <% end %>
    <div class="card-showtrip-info">
     
        <h1><%= @trip.name %></h1>
        <br>
        <div class="info">
        <p>Start Date:</p>
        <%= @trip.start_date.strftime("%d/%m/%Y")  %>
        </div>
        
        <div class="info">
        <p>End Date:</p>
        <%= @trip.end_date.strftime("%d/%m/%Y")  %>
        </div>
    
        <div class="info">
        <p>Category:</p>
        <%= @trip.category.name %>
        </div>
        
        <div class="info">
        <p>Difficulty:</p>
        <%= @trip.difficulty %>
        </div>
        
        <div class="info">
        <p>Location:</p>
        <%= @trip.address %>
        </div>
       
        <div class="info">
        <p>Description:</p>
        <%= @trip.description %>
        </div>
        
        <div class="info">
        <p>Estimated fuel price:</p>
        <%= humanized_money_with_symbol(@trip.price_cents) %>
        </div>
      
    </div>
  </div>


  <div class="card-profiles-showtrip">
    <div class="card-profiles-info-showtrip">
      <h4>Profiles</h4>
      <p>Your Local Exporer:</p>
      <div class="local-explorer-card">
        <% if @trip.user.profile.profile_photo.attached? %>
          <%= cl_image_tag @trip.user.profile.profile_photo.key, class: "avatar dropdown-toggle", id: "navbarDropdown", data: { bs_toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
        <% else %>
          <%= image_tag "https://www.slotcharter.net/wp-content/uploads/2020/02/no-avatar.png", class: "avatar dropdown-toggle", id: "navbarDropdown", data: { bs_toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
        <% end %>
        <%= link_to @trip.user.profile.username, profile_path(@trip.user.profile.id) %>
      </div>
      <br>
      <br>
      <p>Your Tripmates:</p>
      <br>
      <br>
      <div class="grid-mates-showtrip">
      <% if @trip.bookings.exists? %>
          <% @trip.bookings.map {|b|b.user}.map {|u| u.profile}.each do |profile|%>
            <% if profile.profile_photo.attached? %>
              <div class="mates-card">
                <%= cl_image_tag profile.profile_photo.key, class: "avatar dropdown-toggle", id: "navbarDropdown", data: { bs_toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
                <%= link_to profile.username, profile_path(profile) %>
              </div>
              <% else %>
              <div class="mates-card">
                <%= image_tag "https://www.slotcharter.net/wp-content/uploads/2020/02/no-avatar.png", class: "avatar dropdown-toggle", id: "navbarDropdown", data: { bs_toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
                <%= link_to profile.username, profile_path(profile) %>
              </div>
              <% end %>
          <% end %>
          <br>
          <br>
          </div>
          <% end %>
      </div>
      <br>
  
    </div>

  <div class="map-container-showtrip">
    <div style="width: 100%; height: 400px; border-radius: 10px;"
        data-controller="map"
        data-map-markers-value="<%= @markers.to_json %>"
        data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
    </div>
  </div>



  <div class= "card-dashboard-tripshow">
    <% if policy(@trip).edit? %>
      <%= link_to "Update trip", edit_trip_path, :class => "btn btn-success"  %>
    <% end %>

    <% if policy(@trip).destroy? %>
      <%= link_to "Delete trip", trip_path(@trip), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}, :class => "btn btn-success" %>
    <% end %>

    <% if @trip.user == current_user && @chatroom %>
      <%= link_to 'open chat', chatroom_path(@chatroom), :class => "btn btn-success" %>
    <% end %>


    <% if current_user.id != @trip.user.id %>
      <% if @trip.bookings.map {|b| b.user_id}.exclude?(current_user.id) %>
        <% if @trip.capacity > @trip.bookings.count %>
          <%= simple_form_for [@trip, @booking] do |f| %>
            <h4>Join us!</h4>
            <div class="form-actions">
              <%= f.button :submit, :class => "btn btn-success"  %>
            </div>
          <% end %>
        <% end %>
      <% end %>
    <% end %>

    <div class="btn btn-success">
      <%= link_to "Back to Trips", trips_path %>
    </div>
  </div>





</div>

